<div class="account-container mat-elevation-z4">
  <mat-sidenav-container class="sidenav-container">
    <mat-sidenav #sidenav mode="side" opened class="sidenav">
      <mat-nav-list>
        <a mat-list-item (click)="setActiveTab(0)" *ngIf="isAuthenticated">Información Personal</a>
        <a mat-list-item (click)="setActiveTab(1)" *ngIf="isAuthenticated">Cambiar Contraseña</a>
        <a mat-list-item (click)="setActiveTab(2)" *ngIf="isAuthenticated">Preferencias</a>
      </mat-nav-list>
    </mat-sidenav>

    <mat-sidenav-content class="main-content">
      <h2>Mi Cuenta</h2>

      <div *ngIf="!isAuthenticated">
        <button mat-raised-button color="primary" (click)="authenticateAccount()">Autenticar Cuenta</button>
      </div>

      <div *ngIf="isAuthenticated && activeTab === 0">
        <form [formGroup]="accountForm" (ngSubmit)="saveChanges()">
          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Nombre</mat-label>
            <input matInput id="nombre" formControlName="nombre" placeholder="Nombre completo" required />
            <mat-error *ngIf="accountForm.get('nombre')?.invalid && accountForm.get('nombre')?.touched">
              El nombre es obligatorio.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Correo Electrónico</mat-label>
            <input matInput id="email" formControlName="email" placeholder="Correo electrónico" required />
            <mat-error *ngIf="accountForm.get('email')?.invalid && accountForm.get('email')?.touched">
              <div *ngIf="accountForm.get('email')?.hasError('required')">El correo electrónico es obligatorio.</div>
              <div *ngIf="accountForm.get('email')?.hasError('email')">Por favor, ingresa un correo electrónico válido.</div>
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Teléfono</mat-label>
            <input matInput id="telefono" formControlName="telefono" placeholder="Teléfono" />
          </mat-form-field>

          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Dirección</mat-label>
            <input matInput id="direccion" formControlName="direccion" placeholder="Dirección" />
          </mat-form-field>

          <button mat-raised-button color="primary" type="submit" [disabled]="accountForm.invalid">Guardar Cambios</button>
        </form>
      </div>

      <div *ngIf="isAuthenticated && activeTab === 1">
        <div *ngIf="isEmailProvider">
          <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Contraseña</mat-label>
              <input matInput type="password" id="password" formControlName="password" placeholder="Nueva contraseña" required />
              <mat-error *ngIf="passwordForm.get('password')?.invalid && passwordForm.get('password')?.touched">
                La contraseña es obligatoria.
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Confirmar Contraseña</mat-label>
              <input matInput type="password" id="confirmPassword" formControlName="confirmPassword" placeholder="Confirmar contraseña" required />
              <mat-error *ngIf="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched">
                Las contraseñas no coinciden.
              </mat-error>
            </mat-form-field>

            <button mat-raised-button color="accent" type="submit" [disabled]="passwordForm.invalid">Actualizar Contraseña</button>
          </form>
        </div>

        <div *ngIf="!isEmailProvider">
          <p>Tu cuenta está vinculada a Google. No puedes cambiar la contraseña desde aquí.</p>
        </div>
      </div>

      <div *ngIf="isAuthenticated && activeTab === 2">
        <form [formGroup]="preferencesForm" (ngSubmit)="savePreferences()">
          <mat-checkbox formControlName="recibirNovedades">Recibir Novedades</mat-checkbox>
          <mat-checkbox formControlName="recibirFacturasPorEmail">Recibir Facturas por Email</mat-checkbox>

          <button mat-raised-button color="primary" type="submit" [disabled]="preferencesForm.invalid">Guardar Preferencias</button>
        </form>
      </div>

      <button mat-button color="warn" (click)="logout()" style="margin-top: 15px;" *ngIf="isAuthenticated">Cerrar sesión</button>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>